(function(a){a.fn.lifestream=function(b){return this.each(function(){var c=a(this),d=jQuery.extend({classname:"lifestream",feedloaded:null,limit:10,list:[]},b),e={count:d.list.length,items:[]},f=jQuery.extend(!0,{},d),g=function(b){a.merge(e.items,b),e.items.sort(function(a,b){return b.date-a.date});var f=e.items,g=f.length<d.limit?f.length:d.limit,h=0,i,j=a('<ul class="'+d.classname+'"/>');for(;h<g;h++)i=f[h],i.html&&a('<li class="'+d.classname+"-"+i.config.service+'">').data("time",i.date).append(i.html).appendTo(j);c.html(j),a.isFunction(d.feedloaded)&&d.feedloaded()},h=function(){var b=0,c=d.list.length;delete f.list;for(;b<c;b++){var e=d.list[b];a.fn.lifestream.feeds[e.service]&&a.isFunction(a.fn.lifestream.feeds[e.service])&&e.user&&(e._settings=f,a.fn.lifestream.feeds[e.service](e,g))}};jQuery.tmpl?h():jQuery.getScript("https://raw.github.com/jquery/jquery-tmpl/master/jquery.tmpl.min.js",h)})},a.fn.lifestream.createYqlUrl=function(a){return"http://query.yahooapis.com/v1/public/yql?q=__QUERY__&env=store://datatables.org/alltableswithkeys&format=json".replace("__QUERY__",encodeURIComponent(a))},a.fn.lifestream.feeds=a.fn.lifestream.feeds||{}})(jQuery),function(a){a.fn.lifestream.feeds.delicious=function(b,c){var d=a.extend({},{bookmarked:'bookmarked <a href="${u}">${d}</a>'},b.template);a.ajax({url:"http://feeds.delicious.com/v2/json/"+b.user,dataType:"jsonp",success:function(e){var f=[],g=0,h;if(e&&e.length&&e.length>0){h=e.length;for(;g<h;g++){var i=e[g];f.push({date:new Date(i.dt),config:b,html:a.tmpl(d.bookmarked,i)})}}c(f)}});return{template:d}}}(jQuery),function(a){a.fn.lifestream.feeds.github=function(b,c){var d=a.extend({},{pushed:'<a href="${status.url}" title="{{if title}}${title} by ${author} {{/if}}">pushed</a> to <a href="http://github.com/${repo}/tree/${branchname}">${branchname}</a> at <a href="http://github.com/${repo}">${repo}</a>',gist:'<a href="${status.payload.url}" title="${status.payload.desc || ""}">${status.payload.name}</a>',commented:'commented on <a href="${status.url}">${what}</a> on <a href="http://github.com/${repo}">${repo}</a>',pullrequest:'${status.payload.action} <a href="${status.url}">pull request #${status.payload.number}</a> on <a href="http://github.com/${repo}">${repo}</a>',created:'created ${status.payload.ref_type || status.payload.object} <a href="${status.url}">${status.payload.ref || status.payload.object_name}</a> for <a href="http://github.com/${repo}">${repo}</a>',createdglobal:'created ${status.payload.object} <a href="${status.url}">${title}</a>',deleted:'deleted ${status.payload.ref_type} ${status.payload.ref} at <a href="http://github.com/${status.repository.owner}/${status.repository.name}">${status.repository.owner}/${status.repository.name}</a>'},b.template),e=function(a){return a.payload.repo||(a.repository?a.repository.owner+"/"+a.repository.name:null)||a.url.split("/")[3]+"/"+a.url.split("/")[4]},f=function(b){var c,f,g;if(b.type==="PushEvent"){f=b.payload&&b.payload.shas&&b.payload.shas.json&&b.payload.shas.json[2],c=e(b);return a.tmpl(d.pushed,{status:b,title:f,author:f?b.payload.shas.json[3]:"",branchname:b.payload.ref.split("/")[2],repo:e(b)})}if(b.type==="GistEvent")return a.tmpl(d.gist,{status:b});if(b.type==="CommitCommentEvent"){g="commit "+b.url.split("commit/")[1].split("#")[0].substring(0,7),c=e(b);return a.tmpl(d.commented,{what:g,repo:c,status:b})}if(b.type==="IssueCommentEvent"){g="issue "+b.url.split("issues/")[1].split("#")[0],c=e(b);return a.tmpl(d.commented,{what:g,repo:c,status:b})}if(b.type==="PullRequestEvent"){c=e(b);return a.tmpl(d.pullrequest,{repo:c,status:b})}if(b.type==="CreateEvent"&&(b.payload.ref_type==="tag"||b.payload.ref_type==="branch"||b.payload.object==="tag")){c=e(b);return a.tmpl(d.created,{repo:c,status:b})}if(b.type==="CreateEvent"){f=b.payload.object_name?b.payload.object_name==="null"?b.payload.name:b.payload.object_name:e(b);return a.tmpl(d.createdglobal,{title:f,status:b})}if(b.type==="DeleteEvent")return a.tmpl(d.deleted,{status:b})},g=function(a){var c=[],d=0,e;if(a.query&&a.query.count&&a.query.count>0){e=a.query.count;for(;d<e;d++){var g=a.query.results.json[d].json;c.push({date:new Date(g.created_at),config:b,html:f(g)})}}return c};a.ajax({url:a.fn.lifestream.createYqlUrl('select json.repository.owner,json.repository.name, json.payload, json.type,json.url, json.created_at from json where url="http://github.com/'+b.user+'.json"'),dataType:"jsonp",success:function(a){c(g(a))}});return{template:d}}}(jQuery),function(a){a.fn.lifestream.feeds.googlereader=function(b,c){var d=a.extend({},{starred:'shared post <a href="${link.href}">${title.content}</a>'},b.template),e=function(c){var e=[],f,g=0,h;if(c.query&&c.query.count&&c.query.count>0){f=c.query.results.feed.entry,h=f.length;for(;g<h;g++){var i=f[g];e.push({date:new Date(parseInt(i["crawl-timestamp-msec"],10)),config:b,html:a.tmpl(d.starred,i)})}}return e};a.ajax({url:a.fn.lifestream.createYqlUrl('select * from xml where url="www.google.com/reader/public/atom/user%2F'+b.user+'%2Fstate%2Fcom.google%2Fbroadcast"'),dataType:"jsonp",success:function(a){c(e(a))}});return{template:d}}}(jQuery),function(a){a.fn.lifestream.feeds.deviantart=function(b,c){var d=a.extend({},{posted:'posted <a href="${link}">${title}</a>'},b.template);a.ajax({url:a.fn.lifestream.createYqlUrl('select title,link,pubDate from rss where url="http://backend.deviantart.com/rss.xml?q=gallery%3A'+encodeURIComponent(b.user)+"&type=deviation"+'" | unique(field="title")'),dataType:"jsonp",success:function(e){var f=[],g,h,i=0,j;if(e.query&&e.query.count>0){g=e.query.results.item,j=g.length;for(;i<j;i++)h=g[i],f.push({date:new Date(h.pubDate),config:b,html:a.tmpl(d.posted,h)})}c(f)}});return{template:d}}}(jQuery),function(a){a.fn.lifestream.feeds.youtube=function(b,c){var d=a.extend({},{favorited:'favorited <a href="${video.player.default}" title="${video.description}">${video.title}</a>'},b.template),e=function(c){var e=[],f=0,g,h;if(c.data&&c.data.items){g=c.data.items.length;for(;f<g;f++)h=c.data.items[f],e.push({date:new Date(h.created),config:b,html:a.tmpl(d.favorited,h)})}return e};a.ajax({url:"http://gdata.youtube.com/feeds/api/users/"+b.user+"/favorites?v=2&alt=jsonc",dataType:"jsonp",success:function(a){c(e(a))}});return{template:d}}}(jQuery),function(a){a.fn.lifestream.feeds.twitter=function(b,c){var d=a.extend({},{posted:"{{html tweet}}"},b.template),e=function(a){var b=function(a){return a.replace(/[a-z]+:\/\/[a-z0-9-_]+\.[a-z0-9-_:~%&\?\/.=]+[^:\.,\)\s*$]/ig,function(a){return'<a href="'+a+'">'+(a.length>25?a.substr(0,24)+"...":a)+"</a>"})},c=function(a){return a.replace(/(^|[^\w]+)\@([a-zA-Z0-9_]{1,15})/g,function(a,b,c){return b+'<a href="http://twitter.com/'+c+'">@'+c+"</a>"})},d=function(a){return a.replace(/(^|[^\w'"]+)\#([a-zA-Z0-9_]+)/g,function(a,b,c){return b+'<a href="http://search.twitter.com/search?q=%23'+c+'">#'+c+"</a>"})};return d(c(b(a)))},f=function(c){var f=[],g=0,h,i;if(c&&c.length>0){h=c.length;for(;g<h;g++)i=c[g],f.push({date:new Date(i.created_at),config:b,html:a.tmpl(d.posted,{tweet:e(i.text)})})}return f};a.ajax({url:"https://api.twitter.com/1/statuses/user_timeline.json",data:{screen_name:b.user,include_rts:1},dataType:"jsonp",success:function(a){c(f(a))}});return{template:d}}}(jQuery),function(a){a.fn.lifestream.feeds.flickr=function(b,c){var d=a.extend({},{posted:'posted a photo <a href="${link}">${title}</a>'},b.template);a.ajax({url:"http://api.flickr.com/services/feeds/photos_public.gne?id="+b.user+"&lang=en-us&format=json",dataType:"jsonp",jsonp:"jsoncallback",success:function(e){var f=[],g=0,h;if(e&&e.items&&e.items.length>0){h=e.items.length;for(;g<h;g++){var i=e.items[g];f.push({date:new Date(i.published),config:b,html:a.tmpl(d.posted,i)})}}c(f)}});return{template:d}}}(jQuery)